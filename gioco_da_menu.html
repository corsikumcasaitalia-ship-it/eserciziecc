<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bar Italia - Interactive Learning</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --dark: #2C3E50;
            --light: #F7F9FC;
            --card-bg: #FFFFFF;
        }

        * { box-sizing: border-box; transition: all 0.3s ease; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--light);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--dark);
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .screen {
            display: none;
            padding: 20px;
            flex-grow: 1;
            flex-direction: column;
            animation: fadeIn 0.4s ease-out;
        }
        
        .screen.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login */
        .login-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, var(--primary), #FF8E53);
            color: white;
        }
        .logo { font-family: 'Pacifico', cursive; font-size: 3rem; margin-bottom: 10px; }
        .login-input { width: 80%; padding: 15px; border-radius: 30px; border: none; text-align: center; font-size: 1.1rem; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-main { background: var(--dark); color: white; padding: 15px 40px; border-radius: 30px; border: none; font-weight: 600; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); width: 80%; }
        .btn-main:active { transform: scale(0.98); }

        /* Dashboard */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .user-badge { background: #eee; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card-btn {
            background: white; border: 2px solid #eee; border-radius: 15px; padding: 15px;
            text-align: center; cursor: pointer; display: flex; flex-direction: column;
            align-items: center; justify-content: center; height: 130px;
        }
        .card-btn:active { background: #f0fffe; border-color: var(--secondary); }
        .card-icon { font-size: 2.2rem; margin-bottom: 8px; }
        .card-title { font-weight: 600; font-size: 0.9rem; margin-bottom: 2px; }
        .card-desc { font-size: 0.7rem; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; }

        /* Game Area */
        .progress-bar { height: 6px; background: #eee; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--secondary); width: 0%; }
        
        .question-card {
            background: #fff; border-radius: 15px; padding: 25px 15px; text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #eee;
        }
        .big-text { font-size: 1.3rem; font-weight: bold; margin-bottom: 5px; color: var(--primary); line-height: 1.4; }
        .sub-text { color: #888; font-size: 0.8rem; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }

        .options-list { display: flex; flex-direction: column; gap: 10px; }
        .option-btn {
            padding: 15px; background: white; border: 2px solid #ddd; border-radius: 12px;
            font-weight: 600; cursor: pointer; text-align: left; position: relative; font-size: 1rem;
        }
        .option-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }

        /* Feedback */
        .feedback-area {
            text-align: center; margin-top: 15px; min-height: 40px;
            padding: 10px; border-radius: 8px; font-size: 0.95rem;
        }
        .grammar-fix { display: block; font-weight: bold; margin-top: 5px; color: #2C3E50; }

        .back-btn { background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; padding: 0 10px; }
        
        /* Menu List */
        .menu-list-view { flex-grow: 1; overflow-y: auto; padding: 5px; }
        .menu-item-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 0.9rem; }
        .cat-title { color: var(--secondary); font-weight: bold; margin-top: 20px; font-size: 0.8rem; text-transform: uppercase; border-bottom: 2px solid #eee; padding-bottom: 5px; }

    </style>
</head>
<body>

<div class="app-container">
    
    <div id="screen-login" class="screen active login-screen">
        <div class="logo">Bar Italia ‚òï</div>
        <input type="text" id="username" class="login-input" placeholder="ƒ∞smin nedir?">
        <button class="btn-main" onclick="handleLogin()">Ba≈üla</button>
    </div>

    <div id="screen-dashboard" class="screen">
        <div class="header">
            <div>
                <div style="font-size:0.8rem; color:#888;">Ciao,</div>
                <h2 style="margin:0;" id="display-name">Studente</h2>
            </div>
            <div class="user-badge">‚≠ê <span id="total-score">0</span></div>
        </div>

        <h3 style="margin-bottom:5px;">Aktiviteler</h3>
        <p style="font-size:0.85rem; color:#888; margin-top:0;">Ne yapmak istersin?</p>

        <div class="menu-grid">
            <div class="card-btn" onclick="startGrammarGame()">
                <div class="card-icon">ü§î</div>
                <div class="card-title">C'√® o Ci sono?</div>
                <div class="card-desc">Gramer Testi</div>
            </div>

            <div class="card-btn" onclick="startLogicGame()">
                <div class="card-icon">üß©</div>
                <div class="card-title">Cosa Prendo?</div>
                <div class="card-desc">Durum & Mantƒ±k</div>
            </div>

            <div class="card-btn" onclick="showMenuStudy()">
                <div class="card-icon">üìñ</div>
                <div class="card-title">Il Listino</div>
                <div class="card-desc">Men√º ƒ∞ncele</div>
            </div>

             <div class="card-btn" onclick="location.reload()" style="border-color:#ffcccc;">
                <div class="card-icon">üëã</div>
                <div class="card-title">Esci</div>
                <div class="card-desc">√áƒ±kƒ±≈ü Yap</div>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="header">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h3 style="margin:0; font-size:1.1rem;" id="game-title">Gioco</h3>
            <div style="width:30px;"></div>
        </div>

        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

        <div class="question-card">
            <div class="sub-text" id="q-category">Kategori</div>
            <div class="big-text" id="q-text">...</div>
        </div>

        <div class="options-list" id="options-container"></div>
        
        <div class="feedback-area" id="feedback"></div>

        <button id="next-btn" class="btn-main" style="margin-top:auto; display:none; width:100%;" onclick="nextQuestion()">Devam ‚Üí</button>
    </div>

    <div id="screen-study" class="screen">
        <div class="header">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h3 style="margin:0;">Listino Prezzi</h3>
            <div style="width:30px;"></div>
        </div>
        <div class="menu-list-view" id="full-menu-list"></div>
    </div>

</div>

<script>
    // --- DATA ---
    // Tags: food, hot_drink, cold_drink, alcohol, no_alcohol
    const menuItems = [
        { name: "Caff√® Espresso", type: "sing", cat: "Caffetteria", article: "un", tags: ["hot_drink", "morning", "no_alcohol"] },
        { name: "Cappuccino", type: "sing", cat: "Caffetteria", article: "un", tags: ["hot_drink", "morning", "no_alcohol"] },
        { name: "Cioccolata", type: "sing", cat: "Caffetteria", article: "una", tags: ["hot_drink", "sweet", "no_alcohol"] },
        { name: "T√® Caldo", type: "sing", cat: "Caffetteria", article: "un", tags: ["hot_drink", "no_alcohol"] },
        
        { name: "Acqua Minerale", type: "sing", cat: "Bibite", article: "un'", tags: ["cold_drink", "thirsty", "no_alcohol"] },
        { name: "T√® Freddo", type: "sing", cat: "Bibite", article: "un", tags: ["cold_drink", "thirsty", "summer", "no_alcohol"] },
        { name: "Succo di Frutta", type: "sing", cat: "Bibite", article: "un", tags: ["cold_drink", "sweet", "no_alcohol"] },
        
        { name: "Aperitivo Alcolico", type: "sing", cat: "Aperitivi", article: "un", tags: ["alcohol", "evening"] },
        { name: "Vino Rosso", type: "sing", cat: "Vino", article: "un", tags: ["alcohol", "evening", "dinner"] },
        { name: "Birra Media", type: "sing", cat: "Birre", article: "una", tags: ["alcohol", "evening", "cold_drink"] },
        
        { name: "Pizzette", type: "plur", cat: "Snack", article: "delle", tags: ["food", "snack", "hungry"] },
        { name: "Toast", type: "sing", cat: "Snack", article: "un", tags: ["food", "snack", "hungry"] },
        { name: "Tramezzini", type: "plur", cat: "Snack", article: "dei", tags: ["food", "snack", "hungry"] }
    ];

    // SCENARIOS FOR LOGIC GAME
    const logicScenarios = [
        { text: "Ho molta fame! (√áok a√ßƒ±m)", correctTag: "food", wrongTag: "drink" },
        { text: "Fa molto caldo, ho sete. (Hava √ßok sƒ±cak)", correctTag: "cold_drink", wrongTag: "hot_drink" },
        { text: "Ho freddo. Vorrei qualcosa di caldo. (√ú≈ü√ºd√ºm)", correctTag: "hot_drink", wrongTag: "cold_drink" },
        { text: "Siamo al bar la sera con gli amici. (Ak≈üam arkada≈ülarla)", correctTag: "alcohol", wrongTag: "morning" },
        { text: "√à mattina, ho bisogno di energia. (Sabah)", correctTag: "morning", wrongTag: "alcohol" },
        { text: "Non bevo alcol. (Alkol i√ßmem)", correctTag: "no_alcohol", wrongTag: "alcohol" },
        { text: "Vorrei mangiare qualcosa di piccolo. (K√º√ß√ºk bir ≈üeyler yemek)", correctTag: "snack", wrongTag: "drink" }
    ];

    let user = "Studente";
    let score = 0;
    let currentQuestionIndex = 0;
    let questions = [];

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function handleLogin() {
        const val = document.getElementById('username').value.trim();
        if(val) { user = val; document.getElementById('display-name').innerText = user; }
        showScreen('screen-dashboard');
    }

    function goHome() { showScreen('screen-dashboard'); document.getElementById('total-score').innerText = score; }

    function showMenuStudy() {
        const container = document.getElementById('full-menu-list');
        container.innerHTML = "";
        let lastCat = "";
        menuItems.forEach(item => {
            if(item.cat !== lastCat) {
                container.innerHTML += `<div class="cat-title">${item.cat}</div>`;
                lastCat = item.cat;
            }
            container.innerHTML += `<div class="menu-item-row"><span>${item.name}</span></div>`;
        });
        showScreen('screen-study');
    }

    // --- GAME 1: GRAMMAR ---
    function startGrammarGame() {
        document.getElementById('game-title').innerText = "C'√® o Ci sono?";
        score = 0; currentQuestionIndex = 0;
        
        questions = menuItems.map(item => {
            return {
                type: "grammar",
                text: `Sul tavolo ________ <br><span style="color:#2C3E50">${item.name.toLowerCase()}.</span>`,
                category: "Bo≈üluƒüu Doldur",
                correctVal: item.type === 'sing' ? "c'√®" : "ci sono",
                feedbackText: `Sul tavolo <span style="color:#27ae60"> ${item.type === 'sing' ? "c'√®" : "ci sono"} ${item.article} ${item.name.toLowerCase()}</span>.`,
                options: ["c'√®", "ci sono"]
            };
        }).sort(() => 0.5 - Math.random()).slice(0, 8);

        showScreen('screen-game');
        loadQuestion();
    }

    // --- GAME 2: LOGIC / SCENARIO (NEW) ---
    function startLogicGame() {
        document.getElementById('game-title').innerText = "Cosa Prendo?";
        score = 0; currentQuestionIndex = 0;

        // Create random scenario questions
        questions = [];
        for(let i=0; i<8; i++) {
            // Pick random scenario
            const scenario = logicScenarios[Math.floor(Math.random() * logicScenarios.length)];
            
            // Find a Correct Item (Has the correctTag)
            const correctItems = menuItems.filter(item => item.tags.includes(scenario.correctTag));
            if(correctItems.length === 0) continue;
            const correctItem = correctItems[Math.floor(Math.random() * correctItems.length)];

            // Find Distractors (Must NOT have the correct tag, preferably have the wrong tag)
            const distractorItems = menuItems.filter(item => !item.tags.includes(scenario.correctTag));
            const shuffledDistractors = distractorItems.sort(() => 0.5 - Math.random()).slice(0, 2);

            if(shuffledDistractors.length < 2) continue;

            // Mix options
            let opts = [correctItem.name, shuffledDistractors[0].name, shuffledDistractors[1].name];
            opts.sort(() => 0.5 - Math.random());

            questions.push({
                type: "logic",
                text: `"${scenario.text}"`,
                category: "Bu durumda ne istersin?",
                correctVal: correctItem.name,
                feedbackText: `Mantƒ±klƒ±! <span style="color:#27ae60">${correctItem.name}</span> bu durum i√ßin uygun.`,
                options: opts
            });
        }
        
        // Remove duplicates if any logic quirk produced them (simple cleanup)
        questions = questions.slice(0, 8);

        showScreen('screen-game');
        loadQuestion();
    }

    function loadQuestion() {
        const q = questions[currentQuestionIndex];
        document.getElementById('q-category').innerText = q.category;
        document.getElementById('q-text').innerHTML = q.text;
        document.getElementById('progress').style.width = `${(currentQuestionIndex / questions.length) * 100}%`;
        document.getElementById('feedback').innerHTML = "";
        document.getElementById('feedback').style.background = "transparent";
        document.getElementById('next-btn').style.display = "none";
        
        const container = document.getElementById('options-container');
        container.innerHTML = "";
        
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q);
            container.appendChild(btn);
        });
    }

    function checkAnswer(btn, selected, q) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        const feedbackBox = document.getElementById('feedback');
        
        if (selected === q.correctVal) {
            btn.classList.add('correct');
            score += 10;
            feedbackBox.innerHTML = `‚úÖ Bravo!<br><span class="grammar-fix">${q.feedbackText}</span>`;
            feedbackBox.style.background = "#e8f5e9";
        } else {
            btn.classList.add('wrong');
            feedbackBox.innerHTML = `‚ùå Yanlƒ±≈ü tercih.<br><span class="grammar-fix">Doƒüru cevap: ${q.correctVal}</span>`;
            feedbackBox.style.background = "#ffebee";
            allBtns.forEach(b => { if(b.innerText === q.correctVal) b.classList.add('correct'); });
        }
        
        document.getElementById('next-btn').style.display = "block";
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) loadQuestion();
        else endGame();
    }

    function endGame() {
        const container = document.getElementById('options-container');
        document.getElementById('q-text').innerText = "Oyun Bitti!";
        document.getElementById('q-category').innerText = "Toplam Puan";
        document.getElementById('progress').style.width = "100%";
        document.getElementById('feedback').innerHTML = "";
        document.getElementById('feedback').style.background = "transparent";
        document.getElementById('next-btn').style.display = 'none';
        
        container.innerHTML = `
            <div style="text-align:center; padding:20px;">
                <div style="font-size:3rem; margin-bottom:10px;">üèÜ</div>
                <h2>Puanƒ±n: ${score}</h2>
                <p>${score > ((questions.length*10)*0.7) ? "Harika Gidiyorsun! üåü" : "Biraz daha √ßalƒ±≈ümalƒ±sƒ±n! üí™"}</p>
                <button class="btn-main" onclick="goHome()">Ana Men√ºye D√∂n</button>
            </div>
        `;
    }
</script>
</body>
</html>
